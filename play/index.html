<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>page-timing</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
        <link rel="shortcut icon" href="https://www.fiverr.com/favicon.ico">
        <link rel="stylesheet" href="https://code.jquery.com/ui/jquery-ui-git.css">
        <style>
* { font-family: monospace; }
        </style>
    </head>
    <body>
    <h1>Page Timing</h1>
    <p><img src="https://dummyimage.com/1000x700/ffeedd/000000.png" width="100" alt="alt text"></p>
    <div>Loading...</div>
    <script>
        // Delay everything by 2 seconds
        const end = Date.now() + 2000;
        while(Date.now() < end) {/*...*/}
    </script>
    <script src="script.js"></script>
    <script>
        const toString = (obj) => Object.entries(obj).map(
            ([key, value]) => [`<strong>${key}</strong>`, value].join(': ')
        ).join('<br>');
        const info = {};
        function print() {
            document.querySelector('div').innerHTML = toString(info)
            // console.table(info);
        }

        window.addEventListener(
            'load',
            () => {
                Object.assign(info, all());
                print();
                [
                    [getLCP, 'largest_contentful_paint'],
                    [getFID, 'first_input_delay'],
                    [getCLS, 'comulative_layout_shift'],
                ].forEach(
                    ([ fn, name ]) => fn(
                        ({ value }) => {
                            info[name] = value;
                            print();
                        }
                    )
                );

                fps().then(result => {
                    info.frames_per_second = result;
                    print()
                })
            }
        );
    </script>
    <script async>
        // Delay everything by 2 seconds
        const end = Date.now() + 2000;
        while(Date.now() < end) {/*...*/}
    </script>
    <script src="https://code.jquery.com/ui/jquery-ui-git.js"></script>
    </body>
</html>
